# ********RoostGPT********

# Test generated by RoostGPT for test MiniProjects using AI Type Open AI and AI Model gpt-4-1106-preview
# 
# Feature file generated for /otpconfirmation_post for http method type POST 
# RoostTestHash=82750b7846
# 
# 

# ********RoostGPT********
Feature: OTP Confirmation API Endpoints

  Background:
    * def urlBase = karate.properties['url.base'] || karate.get('urlBase', 'http://localhost:8080')
    * url urlBase
    * def authToken = karate.properties['AUTH_TOKEN']

  Scenario Outline: Validate OTP confirmation with valid request
    Given path '/otpconfirmation'
    And header Authorization = 'Bearer ' + authToken
    And header x-fapi-customer-ip-address = '<x-fapi-customer-ip-address>'
    And header x-fapi-auth-date = '<x-fapi-auth-date>'
    And header x-fapi-interaction-id = '<x-fapi-interaction-id>'
    And header x-idempotency-key = '<x-idempotency-key>'
    And request <requestBody>
    When method post
    Then status 201
    And match response == <expectedResponse>

    Examples:
      | x-fapi-customer-ip-address | x-fapi-auth-date                | x-fapi-interaction-id | x-idempotency-key | requestBody                                                                                                                                   | expectedResponse                                                                                             |
      | '192.168.1.1'              | 'Sun, 10 Sep 2017 19:43:31 UTC' | 'uuid-1234'           | 'key-1234'        | { "mandateIdentification": "HSBC123", "otpIdentificationNumber": "1234567890", "otpPassword": "password", "creditorAccount": { "bankCode": "123", "accountIdentification": "ACC123", "currency": "USD" }} | { "processResult": { "responseCode": "00" }, "mandateIdentification": "HSBC123", "creditorReference": "CRED123" } |

  Scenario: OTP confirmation with missing required headers
    Given path '/otpconfirmation'
    And header Authorization = 'Bearer ' + authToken
    And request
    """
    { 
      "mandateIdentification": "HSBC123", 
      "otpIdentificationNumber": "1234567890", 
      "otpPassword": "password", 
      "creditorAccount": { 
        "bankCode": "123", 
        "accountIdentification": "ACC123", 
        "currency": "USD" 
      }
    }
    """
    When method post
    Then status 400
    And match response.errors[*].code contains 'OB.Field.Missing'

  Scenario: OTP confirmation with invalid bearer token
    Given path '/otpconfirmation'
    And header Authorization = 'Bearer invalid_token'
    And request
    """
    { 
      "mandateIdentification": "HSBC123", 
      "otpIdentificationNumber": "1234567890", 
      "otpPassword": "password", 
      "creditorAccount": { 
        "bankCode": "123", 
        "accountIdentification": "ACC123", 
        "currency": "USD" 
      }
    }
    """
    When method post
    Then status 401
    And match response.errors[*].code contains 'OB.Field.Invalid'

  Scenario: OTP confirmation with unsupported method (GET instead of POST)
    Given path '/otpconfirmation'
    And header Authorization = 'Bearer ' + authToken
    When method get
    Then status 405
    And match response.errors[*].code contains 'OB.Method.NotAllowed'
